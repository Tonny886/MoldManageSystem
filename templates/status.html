<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»ŸçŠ¶æ€ç›‘æ§</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .status-card {
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-healthy { background-color: #28a745; }
        .status-warning { background-color: #ffc107; }
        .status-error { background-color: #dc3545; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">ä¿å…»äººå‘˜ç®¡ç†ç³»ç»Ÿ</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/index">é¦–é¡µ</a>
                <a class="nav-link active" href="/status">ç³»ç»ŸçŠ¶æ€</a>
                <a class="nav-link" href="/logout">é€€å‡º</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h2>ğŸ“Š ç³»ç»ŸçŠ¶æ€ç›‘æ§</h2>
        <p class="text-muted">æœ€åæ›´æ–°: {{ current_time }}</p>
        
        {% if status_info %}
        <div class="row">
            <div class="col-md-8">
                <div class="card status-card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">ç³»ç»ŸçŠ¶æ€</h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-striped">
                            <tbody>
                                {% for key, value in status_info.items() %}
                                <tr>
                                    <td><strong>{{ key }}</strong></td>
                                    <td>
                                        {% if value is string %}
                                            {% if 'æ­£å¸¸' in value or 'è¿è¡Œ' in value or 'æ­£å¸¸' in value %}
                                                <span class="status-indicator status-healthy"></span>
                                            {% elif 'æ–­å¼€' in value or 'åœæ­¢' in value or 'å¼‚å¸¸' in value or 'å¤±è´¥' in value %}
                                                <span class="status-indicator status-error"></span>
                                            {% else %}
                                                <span class="status-indicator status-warning"></span>
                                            {% endif %}
                                        {% endif %}
                                        {{ value }}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="card status-card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">å¿«é€Ÿæ“ä½œ</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2 d-md-flex">
                            <a href="/health" target="_blank" class="btn btn-outline-primary">å¥åº·æ£€æŸ¥</a>
                            <a href="/wakeup" target="_blank" class="btn btn-outline-success">æ‰‹åŠ¨å”¤é†’</a>
                            <a href="/admin" class="btn btn-outline-secondary">ç®¡ç†é¢æ¿</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card status-card">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0">é˜²ä¼‘çœ çŠ¶æ€</h5>
                    </div>
                    <div class="card-body">
                        <div id="wakeupTimer" class="display-4 text-center mb-3">--:--</div>
                        <p class="text-center">è·ç¦»ä¸‹æ¬¡è‡ªåŠ¨å”¤é†’</p>
                        
                        <div class="mt-4">
                            <h6>å¹³å°ä¼˜åŒ–é…ç½®:</h6>
                            <ul class="list-unstyled">
                                <li>ğŸ“± æ£€æµ‹å¹³å°: {{ status_info.get('å¹³å°', 'æœªçŸ¥') }}</li>
                                <li>â° å”¤é†’é—´éš”: {{ status_info.get('å”¤é†’é—´éš”', 'æœªè®¾ç½®') }}</li>
                                <li>ğŸ”„ æœ€åæ´»åŠ¨: {{ status_info.get('æœ€åæ´»åŠ¨', 'æœªçŸ¥') }}</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="alert alert-danger">
            <h4>âš ï¸ çŠ¶æ€ä¿¡æ¯ä¸å¯ç”¨</h4>
            <p>æ— æ³•è·å–ç³»ç»ŸçŠ¶æ€ä¿¡æ¯ï¼Œè¯·æ£€æŸ¥åº”ç”¨é…ç½®ã€‚</p>
            <a href="/health" class="btn btn-outline-primary">æ£€æŸ¥å¥åº·çŠ¶æ€</a>
        </div>
        {% endif %}
    </div>

    <script>
        // å®‰å…¨çš„å”¤é†’å€’è®¡æ—¶
        try {
            // å°è¯•è·å–å”¤é†’é—´éš”å’Œç©ºé—²æ—¶é—´
            let wakeupInterval = parseInt("{{ status_info.get('å”¤é†’é—´éš”', '0') }}".replace('ç§’', '')) || 1500;
            let lastActivity = "{{ status_info.get('æœ€åæ´»åŠ¨', '') }}";
            
            // å¦‚æœæ— æ³•è®¡ç®—ï¼Œæ˜¾ç¤ºé™æ€ä¿¡æ¯
            if (!lastActivity || lastActivity === 'æœªçŸ¥') {
                document.getElementById('wakeupTimer').textContent = "ä¿¡æ¯ä¸è¶³";
            } else {
                // ç®€å•æ¨¡æ‹Ÿï¼šå‡è®¾ä»æœ€åæ´»åŠ¨å¼€å§‹è®¡æ—¶
                let remaining = Math.max(0, wakeupInterval - 60); // å‡è®¾60ç§’å·²è¿‡å»
                
                function updateTimer() {
                    if (remaining <= 0) {
                        document.getElementById('wakeupTimer').textContent = "å³å°†å”¤é†’";
                        remaining = wakeupInterval;
                    } else {
                        let minutes = Math.floor(remaining / 60);
                        let seconds = remaining % 60;
                        document.getElementById('wakeupTimer').textContent = 
                            `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                        remaining--;
                    }
                }
                
                updateTimer();
                setInterval(updateTimer, 1000);
            }
        } catch (e) {
            document.getElementById('wakeupTimer').textContent = "è®¡ç®—é”™è¯¯";
        }
    </script>
</body>
</html>